\documentclass[10pt,a4paper]{article}
\hfuzz=10.002pt

% Modern font setup
\usepackage{fontspec}
\usepackage{unicode-math}
\usepackage{mathrsfs}

% optional: define shortcuts
\newcommand{\St}{\mathbf{S}}
\newcommand{\A}{\mathbf{A}}
\newcommand{\R}{\mathbf{R}}
\newcommand{\Ptr}{\mathbf{P}}
\newcommand{\Obs}{\mathbf{O}}

% Font selection
\setmainfont{Fira Sans}
\setsansfont{Fira Sans}
\setmonofont[
  UprightFont   = *,
  BoldFont      = *,
  ItalicFont    = *,    % <-- force regular to be used as “italic”
  BoldItalicFont= *% <-- or omit if you don’t need Bold Italic
]{Fira Code}
\usepackage[utf8]{inputenc} % optional with XeLaTeX, but safe
\usepackage[brazil]{babel}
\usepackage{geometry}
\geometry{margin=2.5cm}

% Good to keep
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{url}
\usepackage{xcolor}
\usepackage{outlines}

% Bibliography
\usepackage[backend=biber,style=authoryear]{biblatex}
\addbibresource{references.bib}
\renewcommand*{\nameyeardelim}{\addcomma\space}

\title{Estruturação de Estados orientada a Game Design em Aprendizado por Reforço}
\author{{\bfseries Marcelo Augusto Salomão Ganem }\\ Universidade Federal de Minas Gerais\\
\texttt{marceloganem@dcc.ufmg.br}
}
\date{\today}
\newcommand{\note}[1]{
    \vspace{0.3cm}
    \colorbox{blue!30}{
            \begin{minipage}{0.4\textwidth}
		    \ttfamily \footnotesize
               #1
            \end{minipage}
        }
    \vspace{0.3cm}
}

\setlength{\columnsep}{1cm} % or whatever you prefer
\begin{document}

\makeatletter
% Title page, optional
% \begin{titlepage}
  % \centering
  % \vspace*{5.5cm}
    % {\Large \bfseries Above title \par}
    % \vspace{1cm}
    % {\Huge \bfseries \@title \par}
  % \vspace{1cm}
  % \vspace{0.5cm}
  % {\Large \@author \par}
  % \vspace{0.5cm}
  % \vfill {\large \today\par}
% \end{titlepage}

\twocolumn
\maketitle
\begin{abstract}
    this is the abstract
\end{abstract}


\section{Introdução}
\label{introduction}

\section{Objetivos}
\label{goals}

Tem-se por objetivo geral deste trabalho rq

\begin{outline}

    \1 rq1

    \1 rq2

\end{outline}

Dessa maneira, espera-se ...

\section{Referencial Teórico}
\label{bw}

\subsection{Machinations}
\label{bw:machinations}

\section{Trabalhos Relacionados}
\label{rw}

\section{Metodologia}
\label{m}

\subsection{Modelagem da sintaxe Machinations}
\label{m:modeling}
Os elementos descritos na Seção \ref{bw:machinations} são definidos por \citeauthor{machinations} de maneira formal o suficiente a permitir uma simulação, mas não exatamente adequada para a implementação de um MDP no contexto de aprendizado por reforço. Assim, essa Subseção se dedica à redefinição formal -- a algum nível de abstração -- dos elementos que compõem um diagrama de Machinations.

\subsubsection{Nós}
\textbf{Nós}, conforme descrito na Seção \ref{bw:machinations}, são representados como vértices $v \in V$. Definimos sua função de estado $x_{v,r}: V \times R \rightarrow \mathbb{R}$ como o número de recursos do tipo $r$ no nó $v$ e a função $m_{v}: V \rightarrow \{0,1,2\}$ como o modo de ativação do nó entre passivo, automático ou interativo. Nós interativos acionados no instante $t$ são dicionados ao conjunto $V^+(t)$. \textbf{Pools}, portanto, são nós que acumulam recursos e sem propriedades especiais.

\textbf{Gates} são semelhantes às pools e também são nós $v \in V$, porém imediatamente redistribuem recursos conforme o seu modo de distribuição $d_v : V \rightarrow \{0,1\}$ -- determinístico ou não-determinístico, e o seu modo de saída $o_v: V \rightarrow \{0,1\}$ -- condicional ou aleatório, conforme descrito na Subseção \ref{m:modeling:dynamics}. Os comportamentos específicos de cada caso são descritos na Subseção seguinte. 


\subsubsection{Conexões}
\label{m:modeling:connections}
Conexões são representadas como arestas $e \in E$, tal que $E$ é a união de uma série de subconjuntos que representam cada um dos diferentes tipos de conexões descritas na Seção \ref{bw:machinations}.

\begin{align*}
    E &= E^R \cup E^S\\
    E^R &= \bigcup_{r \in R} E^r\\
    E^S &= E^{T} \cup E^{N} \cup E^{G} \cup E^{A}
\end{align*}

Essa composição, apesar de extensa, define toda a taxonomia das conexões definidas por \citeauthor{machinations}.

\textbf{Conexões de recursos} são representadas pelo subconjunto $E^R$ como a união das conexões para cada tipo de recurso $r$. Uma conexão de recurso específica $e \in E^R$ é da forma $(u \rightarrow v)$ e tem definida para si uma função de taxa $T_e$ --- uma variável aleatória\footnote{Para lidar com valores inteiros, reais ou probabilísticos} representando a transferência de recursos do nó $u$ para o nó $v$ em um instante de tempo. O tipo de recurso a ser transferido por $e$ é identificado por $\tau (e) = r$.

O conjunto $E^S$ define as \textbf{conexões de estado}. Essas, por sua vez, se dividem em:

\begin{outline}
    \1 $E^T$: \textbf{modificadores de taxa}\footnote{Do original \textit{label modifiers} \parencite{machinations}. O rótulo aqui é representado pela taxa $T_e$}, $e \in E^T = (u, r\rightarrow e')$, tal que a taxa $\dot{T}_{u,r,e}$ representa como mudanças no estado $x_{u, r}$ alteram o valor de $T_{e'}$.
    \1 $E^N$: \textbf{modificadores de nó}, $e \in E^N = (u, r \rightarrow v)$. A função $\dot{T}_{u,r,v}$ semelhantemente define como mudanças no estado $x_{u, r}$ alteram o valor de $x_{v, r}$.
    \1 $E^G$: \textbf{gatilhos}, $e \in E^G = (u \rightarrow v)$, seguem a definição da Seção \ref{bw:machinations} e determinam se um nó faz parte ou não do conjunto $V^*(t)$ de nós ativos\footnote{Da definição original \textit{firing} \parencite{machinations}} no tempo $t$. 
    \1 $E^A$: \textbf{ativadores}, $e \in E^A = (u \rightarrow v)$, determinam uma condição $P_e$ em função do estado $x_{u}$ tal que, quando não satisfeita no instante $t$, $v \notin V^*(t)$.
    % They activate or inhibit their target node based on the state of their source node and a specific condition.  Conditions are written as an arithmetic expression (for example ‘==0’, ‘<3’, ‘>=4’ or ‘!=2’) or a range of values (for example ‘3-6’). If the state of the source node meets this condition then the target node is activated (it can fire). When the condition is not met the target node is inhibited (it cannot fire).\\
    % \note{I think we can just infer whether a node is activatable from the current state of activators and other nodes}
\end{outline}

No caso de \textit{gates}, valem as seguintes regras particulares: as únicas conexões que partem de \textit{gates} são conexões de recursos e gatilhos. Ainda, suas saídas podem ser condicionais ou aleatórias. Com saídas condicionais, cada conexão $e \in E^G \cup E^R$ partindo de uma \textit{gate} $v$ é rotulada por uma condição $P_e = f(x_v)$. Com saídas aleatórias, os rótulos são pesos $p_e$, avaliados contra o quociente $q_v$ para decidir qual conexão será ativada quando o nó for ativado.

Para \textit{gates} do modo de distribuição não - determinístico, um valor é amostrado aleatoriamente considerando um total (ou quociente) $q_v$ a cada turno, avaliado contra os pesos $p_e$ ou condições $P_e$ de cada uma de suas saídas para decidir qual será ativada. No caso determinístico, o valor utilizado é o total de recursos transferidos pelo nó até o instante $t$.

\subsubsection{Dinâmica}
\label{m:modeling:dynamics}
A Seção 4.2 de \textit{Engineering Emergence} define três modos de execução temporal -- este trabalho se limita ao caso de tempo síncrono onde, a cada instante $t$, todos os nós automáticos\footnote{Contadores podem ser implementados como um nó adicional e suas respectivas conexões} e os nós interativos acionados no instante $t-1$ são ativados. Conforme a definição original, todos os nós ativos no instante $t$ são processados ao mesmo tempo, levando a condições de corrida desambiguadas com regras específicas onde pertinente.

A transição de estados entre o tempo $t$ e o tempo $t+1$ dadas as definições acima pode ser computada primeiro identificando quais elementos de $V$ estão em $V^*(t)$ e então distribuindo os recursos conforme as conexões $e$ pertinentes a quaisquer $u,v \in V^*$.

Para definir os nós pertencentes a $V^*(t)$, consideramos nós automáticos, nós interativos acionados na etapa anterior, nós ativados por gatilhos e o efeito de ativadores:

\begin{align*}
    V^*(t) &= \{v \in V \ | \ m_v = 1\}\\& \cup \{v \in V^+(t-1)\}\\
    & \cup \{v: (u \rightarrow v) \in E^G\ | \\\
    &\Big(\prod_{e \in E^R | e = (* \rightarrow u)}{\Delta e(t-1) = T_e \Big)} = 1 \}\\
    &\cap \{v: (u \rightarrow v) \in E^A\ | \ P_e(x_u, t) = 1 \}\\
\end{align*}

Então, tomamos as arestas entrando em cada nó $v$ ativo no instante atual $E^*(t) = \{e \in E, v_e \in V^*(t)\}$ como o conjunto das conexões a serem disparadas no instante $t$. Tomando a interseção com cada um dos subconjuntos de $E$ definidos nessa Seção, podemos atualizar o estado de cada nó ou conexão pertinente. Denominamos $E^{T*}$ o conjunto $E^T \cap E^*$, e assim equivalentemente para os demais subconjuntos definidos na Subseção \ref{m:modeling:connections}.

Atualizamos primeiro os alvos dos modificadores de taxa -- para cada alvo $e$ no conjunto \{$e \in E^R \ | \ (u, r \rightarrow e) \in E^{T*}\}$, temos:

$$
T_{e}(t+1) = T_{e}(t) + \dot{T}_{u,r,e} \Delta x_{u,r}
$$

Em seguida, atualizamos o estado dos alvos de modificadores de nó. Para cada nó $v$ no conjunto $\{v \in V \ | \ (u, r \rightarrow v) \in E^{N*}\}$:

$$
x_{v, r}(t+1) = x_{v, r}(t) + \dot{T}_{u,r,v} \Delta x_{u,r}
$$

Por fim, fazemos a transferência de recursos conforme cada $e \in E^{R*}$, sendo $(u, v) = e$ e $r = \tau(e)$:

\begin{align*}
    x_{v, r}(t+1) &= x_{v,r}(t) + T_e(t)\\
    x_{u, r}(t+1) &= x_{u,r}(t) - T_e(t)\\
\end{align*}

Esta descrição da dinâmica permite a simulação completa de diagramas Machinations como um ambiente de MDP de estado $S = \{x_v : v \in V\}$, garantidas desambiguações na implementação.

\subsection{Modelagem do POMDP}
\label{m:mdp}

Para o propósito de aprendizado por reforço, definimos os ambientes produzidos por diagramas Machinations como processos de decisão de Markov parcialmente observáveis. 

Espaço de estados $\St$, probabilidade de transição $\Ptr$, powerset $\mathcal{P}$

\subsubsection{Estados}
\label{m:mdp:states}
Sejam $X = \{x_{v,r} : (v, r) \in V \times R\}$ e $T = \{e_t : e \in E^R\}$, definimos o espaço de estados do MDP como $\St = X \times T$, tal que, no instante $t$, um estado $S_t = (X_t, T_t)$. Isto é, o estado é o número de recursos de cada tipo em cada nó em $V$, bem como a taxa de cada uma das conexões de recurso no diagrama.

Ainda, como é o caso em parte significativa dos jogos, o agente não tem informações completas sobre o estado. Formalmente, separamos os vetores $X$ e $T$ em $(X^o, X^h)$ e $(T^o, T^h)$ -- para as partes observáveis e escondidas, respectivamente, e definimos um espaço de observação $\Omega = X^o \times T^o$. Assim, temos a função de observação $\Obs : \St \rightarrow \Omega$, responsável por definir quais partes do estado são observáveis ou não.

Vale ressaltar que a definição do processo como um POMDP ainda permite a aplicação da maioria das técnicas de aprendizado por reforço que presumem um MDP -- com a ressalva de um sinal de percepção mais ruidoso, a depender do grau de parcialidade da observação.

\subsubsection{Ações}
\label{m:mdp:actions}
Considerando a definição de tempo síncrono em Machinations, onde um agente pode acionar qualquer número de nós interativos no máximo uma vez por instante, definimos $\A = \mathcal{P}(\{ v \in V \ | \ m_v = 2\})$, i.e., o conjunto potência dos nós interativos.

\subsubsection{Recompensas}
\label{m:mdp:rewards}
Considerando a diversidade de critérios de sucesso em jogos, visando um esquema de recompensas agnóstico a diagramas específicos, definimos pesos $\omega$ e $\rho$ para cada elemento de $X$ e $T$, respectivamente. Seguindo o princípio de \textit{potential-based shaping} \parencite{potential-rl}, temos:

\begin{align*}
    \Phi(s) &= \sum_{v\in V^{\Phi}}\sum_{r \in R^{\Phi}}\omega_{v,r}\,x_{v,r}\\
          &\ \ \ \ +\;\sum_{e\in E^{R^{\Phi}}}\rho_{e}\,T_{e},\\
\R(s,a,s') &= \Phi(s') \;-\; \Phi(s).
\end{align*}

Assim, para cada especificação de diagrama Machinations, pode-se definir também os critérios específicos de recompensa conforme cada um dos nós. Ainda, a definição da função de potencial $\Phi$ facilita a extensão do esquema de recompensas conforme novos critérios.

\subsubsection{Transições}
\label{m:mdp:transitions}
Nessa implementação, a função de transições $\Ptr (s' | s, a)$ não é explicitamente modelada. Em vez disso, amostra-se estados seguintes a partir de uma simulação conforme especificado na Subseção \ref{m:modeling:dynamics}. Essa decisão pode ser detrimental para estratégias de aprendizado por reforço que sejam \textit{model-based}, i.e., que tentem estimar uma função $\Ptr (s' | s, a)$ não definida.

A construção de modelos da função de transição ou a sua composição analítica a partir dos componentes de um dado diagrama Machinations são possíveis direções de investigação para estudos futuros.

\subsection{Plano de Experimentos}
\label{m:experiments}

\printbibliography


\end{document}

